# "正在输入"状态功能文档

## 功能描述
当AI助手回复私聊消息时，显示"对方正在输入..."状态。

## 技术实现
- 监听pi-agent-core的`message_start`和`message_end`事件
- 调用NapCat的`set_input_status` API
- 只支持私聊，群聊静默跳过

## 核心功能

### 1. 状态管理
- `startTyping()`: 开始显示"正在输入"状态
- `stopTyping()`: 停止显示"正在输入"状态
- 自动集成到流式消息处理流程中

### 2. 错误处理
- 状态缓存：避免重复调用API
- 超时机制：30秒后自动停止状态
- 静默失败：API调用失败不影响正常消息发送

### 3. 边界情况
- 群聊：自动跳过，不显示错误
- 重复事件：状态缓存防止重复调用
- 长时间无响应：超时自动清理

## 使用示例
```typescript
// 自动触发，无需手动调用
// 当AI开始回复时自动显示"正在输入"
// 当AI完成回复时自动停止"正在输入"
```

## 配置选项
暂无配置选项

## 已知限制
- 只支持私聊
- 依赖NapCat API可用性
- 不支持群聊"正在输入"状态

## 日志输出
```
[Typing] 开始显示正在输入状态 for 123456789
[Typing] 结束正在输入状态 for 123456789
[Typing] 群聊不支持正在输入状态
[Typing] 超时自动停止 for 123456789
```

## 实现细节
- 集成在`BakaBot.registerMsgHandler()`中
- 使用`Map`进行状态缓存
- 使用`setTimeout`进行超时管理
